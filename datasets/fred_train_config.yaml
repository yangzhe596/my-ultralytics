# ==================== FRED 训练配置文件 ====================
# 此文件包含所有训练相关的参数，便于管理和调整

# 数据集选择
dataset:
  use_simple: false  # true使用fred_simple，false使用完整fred数据集
  
  # fred_simple数据集配置
  simple:
    config_file: "datasets/fred_simple.yaml"
    name_prefix: "fred_simple"
    freeze: 0  # 冻结层数，0表示不冻结任何层
    freeze_epochs: 0  # 冻结训练的轮数，0表示不使用两阶段训练
    # 注意：YOLOv8模型结构：
    # - 层 0-9: Backbone（特征提取）
    # - 层 10-21: Neck（特征融合）
    # - 层 22: Detect（检测头）
    # - freeze=10: 只冻结Backbone
    # - freeze=22: 冻结Backbone+Neck，只训练检测头
  
  # 完整fred数据集配置
  full:
    config_file: "datasets/fred_yolo/fred_rgb.yaml"
    name_prefix: "fred_rgb"
    freeze: 10  # 冻结层数，只冻结Backbone（层0-9）
    freeze_epochs: 30  # 冻结训练的轮数
    # 注意：YOLOv8模型结构：
    # - 层 0-9: Backbone（特征提取）
    # - 层 10-21: Neck（特征融合）
    # - 层 22: Detect（检测头）
    # - freeze=10: 只冻结Backbone
    # - freeze=22: 冻结Backbone+Neck，只训练检测头

# 训练参数
training:
  # 基础参数
  epochs: 100  # 总训练轮数
  imgsz: 640  # 输入图像大小
  batch_size: 8  # 批次大小，减小以防止内存溢出
  device: "0"  # 设备，"0"表示第一个GPU，"cpu"表示使用CPU
  
  # 学习率和优化器
  lr0: 0.001  # 初始学习率，降低以防止梯度爆炸
  lrf: 0.01  # 最终学习率 (final LR = lr0 * lrf)
  optimizer: "SGD"  # 优化器类型，SGD更稳定
  momentum: 0.937  # SGD动量/Adam beta1
  weight_decay: 0.0005  # 权重衰减系数
  
  # 学习率调度
  warmup_epochs: 5  # 预热训练轮数，增加以稳定训练
  warmup_momentum: 0.8  # 预热初始动量
  warmup_bias_lr: 0.05  # 预热初始偏置学习率，降低
  
  # 数据增强
  hsv_h: 0.01  # 色调增强范围，减小以防止不稳定
  hsv_s: 0.5  # 饱和度增强范围，减小
  hsv_v: 0.3  # 明度增强范围，减小
  degrees: 0.0  # 旋转角度范围（度）
  translate: 0.05  # 平移范围（相对于图像大小），减小
  scale: 0.3  # 缩放范围，减小
  shear: 0.0  # 剪切角度范围（度）
  perspective: 0.0  # 透视变换范围（0-0.001）
  flipud: 0.0  # 上下翻转概率
  fliplr: 0.5  # 左右翻转概率
  mosaic: 0.8  # Mosaic增强概率，减小
  mixup: 0.0  # MixUp增强概率
  
  # 训练控制
  patience: 20  # 早停轮数，如果验证集性能在patience轮内没有改善则停止训练
  save_period: 5  # 模型保存频率，每save_period轮保存一次
  workers: 16  # 数据加载工作进程数
  close_mosaic: 10  # 最后10轮关闭Mosaic增强
  
  # 验证和测试
  val_period: 1  # 验证频率，每val_period轮验证一次
  test_after_train: true  # 训练完成后是否在测试集上评估
  
  # 模型保存
  project: "runs/train"  # 项目目录
  exist_ok: true  # 是否允许覆盖已存在的项目目录
  pretrained: true  # 是否使用预训练权重

# 模型配置
model:
  size: "s"  # 模型大小，可选：n, s, m, l, x
  
  # 两阶段训练的学习率调整
  stage1_lr: 0.001  # 第一阶段（冻结）学习率，降低以防止梯度爆炸
  stage2_lr: 0.0005  # 第二阶段（解冻）学习率

# 输出和日志
output:
  conf: 0.001  # 置信度阈值（用于推理）
  iou: 0.6  # NMS IoU阈值
  max_det: 300  # 每张图像最大检测数

# 可视化
visualization:
  plots: false  # 是否绘制训练曲线
  plots_epoch: 10  # 每10轮绘制一次
  visualize: false  # 是否可视化预测结果

# 高级参数
advanced:
  rect: false  # 是否使用矩形训练
  cos_lr: false  # 是否使用余弦学习率调度
  nbs: 64  # 标称批次大小
  # ====================================================